<div id="leaderboard"></div>

<script>
const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQLuX2Ta2veASjc85NnEfOIDXXKzVUGm9m-ag_ubn202I8nxmq27_B3UoNS2_h8yEzuVQWOKTP4yKVj/pub?output=csv';

async function loadLeaderboard() {
  try {
    const res = await fetch(sheetURL);
    const data = await res.text();
    console.log("Raw CSV Data:", data);

    const rows = data
      .trim()
      .split('\n')
      .map(r => {
        const row = r.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
        return row ? row.map(cell => cell.replace(/^"|"$/g, '')) : [];
      })
      .filter(row => row.length > 0);

    console.log("Parsed Rows:", rows);

    const headers = rows.shift();
    const wagerIndex = headers.findIndex(h => h.toLowerCase().includes("wager"));
    
    // Sort by wager amount descending
    const sorted = rows.sort((a, b) => {
      const aVal = parseFloat((a[wagerIndex] || "0").replace(/[^\d.]/g, ''));
      const bVal = parseFloat((b[wagerIndex] || "0").replace(/[^\d.]/g, ''));
      return bVal - aVal;
    });

    const table = document.createElement('table');
    table.style.width = '100%';
    table.style.borderCollapse = 'collapse';
    table.style.marginTop = '10px';
    table.style.color = 'white';

    const thead = document.createElement('thead');
    const trHead = document.createElement('tr');
    headers.forEach(h => {
      const th = document.createElement('th');
      th.textContent = h;
      th.style.padding = '10px';
      th.style.borderBottom = '2px solid gray';
      th.style.textAlign = 'left';
      th.style.background = '#333';
      trHead.appendChild(th);
    });
    thead.appendChild(trHead);
    table.appendChild(thead);

    const tbody = document.createElement('tbody');
    sorted.forEach(row => {
      const tr = document.createElement('tr');
      row.forEach(cell => {
        const td = document.createElement('td');
        td.textContent = cell;
        td.style.padding = '8px';
        td.style.borderBottom = '1px solid #444';
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);

    const container = document.getElementById('leaderboard');
    container.innerHTML = ''; // Clear any previous content
    container.appendChild(table);

  } catch (err) {
    console.error('Leaderboard fetch failed:', err);
    document.getElementById('leaderboard').textContent = 'Failed to load leaderboard.';
  }
}

loadLeaderboard();
</script>
